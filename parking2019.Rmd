---
title: "Untitled"
author: "Putu Wahyu Saputra"
date: "6/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE, cache=TRUE)
```

```{r libraries}
library(dplyr)
library(readr)
library(tidyverse)
library(lubridate)
library(tsibble)
library(sugrrants)
library(leaflet)
library(ggmap)
library(here)
library(mapview)
library(broom)
library(rpart.plot)
library(stringr)
```

```{r read-in, cache = TRUE}
parking2019 <- read.csv(here::here("On-street_Car_Parking_Sensor_Data_-_2019.csv"))
```

```{r clean-parking2019}
# Retrieve Lonsdale street and its between streets
parking2019_tidy <- parking2019 %>%
  # Retrieve Lonsdale Street data
  ## Remove parking lots without parking signs  
  filter(StreetName == "LONSDALE STREET",
         !(is.na(SignPlateID))) %>% 
  # Separate date and time variables
   separate(ArrivalTime, into = c("arr_date", "arr_time"), sep =" ") %>%
   separate(DepartureTime, into = c("dep_date", "dep_time"), sep = " ")

# Format date variables from CHAR to DATE 
parking2019_tidy$arr_date <- mdy(parking2019_tidy$arr_date)
parking2019_tidy$dep_date <- mdy(parking2019_tidy$dep_date)

# Extract hour& minutes 
parking2019_tidy$arr_hour <- format(as.POSIXct(parking2019_tidy$arr_time,format="%H:%M:%S"),"%H")
parking2019_tidy$arr_min <- 
format(as.POSIXct(parking2019_tidy$arr_time,format="%H:%M:%S"),"%M")
parking2019_tidy$dep_hour <- format(as.POSIXct(parking2019_tidy$dep_time,format="%H:%M:%S"),"%H")
parking2019_tidy$dep_min <- format(as.POSIXct(parking2019_tidy$arr_time,format="%H:%M:%S"),"%M")
parking2019_tidy$arr_time <- format(as.POSIXct(parking2019_tidy$arr_time,format="%H:%M:%S"),"%H: %M")
parking2019_tidy$dep_time <- format(as.POSIXct(parking2019_tidy$dep_time,format="%H:%M:%S"),"%H: %M")

# remove unrelated variables
parking2019_tidy <- parking2019_tidy %>%
  select(-DeviceId,
         -StreetMarker,
         -StreetId,
         -BetweenStreet2,
         -BetweenStreet2ID,
         -AreaName) 
```

```{r read-in-tidy-data, cache = TRUE}
parking2019_tidy <- write_csv(parking2019_tidy, "parking2019_tidy.csv")
```

```{r summary-violations}
summ_parking2019_vio <- parking2019_tidy %>%
  group_by(InViolation) %>%
  summarise(total = sum(n()))
```

Facts:
> Parking Services Officers may mark the tire of a vehicle parked in a time-restricted area& come back as soon as you overstay the time restriction.
> Inside Melbourne CBD, the parking fees for on street-parking is [$7/hr](https://www.melbourne.vic.gov.au/parking-and-transport/parking/parking-locations-fees/Pages/parking-locations-and-fees.aspx).

Data:
> In 2019, a total of 249,216 instances where a car parked& departed.
> Of this, 10,191 (2.918%) violated the restriction.
* This proportion may seem little, but parking fines are on average, [$124](https://www.melbourne.vic.gov.au/parking-and-transport/parking/parking-fines/Pages/default.aspx#:~:text=Penalty%20amounts%E2%80%8B,State%20Government%20and%20increase%20annually.) when you overstay! $`r 124*summ_parking2019_vio[,2]` were paid just for the fines in Lonsdale Street!


# Along Lonsdale Street, which locations do most vehicles overstay in?

```{r parking-violation}
parking2019_vio <- parking2019_tidy %>%
  filter(InViolation == "true")
```

```{r}
parking2019_vio %>%
  group_by(BetweenStreet1) %>%
  summarise(n = n()) %>%
  arrange(desc(n))
```

* Out of the all five streets, Exhibition Street had the most number of vehicles which violated the time restriction.
* Exhibition St and Russel St are actually right next to one another! What do they have in common? (*elaborate*) - many rooftop bars etc.

```{r}
parking2019_vio %>%
  group_by(BetweenStreet1, Sign) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) %>%
  head(10)
```

* We'd expect more vehicles to overstay in parking lots with a shorter time frame
* BUT, most vehicles overstayed in where the time restrictions were 2 hours

# Analysis 1: Arrival& Departure times of cars that overstayed
```{r}

```


# Analysis 2: Avg. time overstayed for each sign
```{r}
unique(parking2019_vio$Sign)
```

```{r}
parking2019_vio <- parking2019_vio %>%
  # Extract specfic signs, assign them according to minutes
  mutate(restrict_mins = case_when(
    str_starts(Sign, "1/2 P") ~ 30, 
    str_starts(Sign, "1P") ~ 60,
    str_starts(Sign, "2P") ~ 120
    ),
    # Compute amount of mins overstayed
    overstay_mins = DurationMinutes - restrict_mins)
```

```{r}

```




