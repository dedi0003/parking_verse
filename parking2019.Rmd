---
title: "Untitled"
author: "Putu Wahyu Saputra"
date: "6/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE, cache=TRUE)
```

```{r libraries}
library(dplyr)
library(readr)
library(tidyverse)
library(lubridate)
<<<<<<< HEAD
library(tsibble)
library(sugrrants)



=======
library(leaflet)
library(ggmap)
library(here)
library(mapview)
>>>>>>> 05dd300e81bc56288b3956118ac76b57c607ed99
```

```{r read}
park19 <- read_csv("park19_tidy.csv")

park19
```

# Section 1 : What is the proportion of vehicles that overstayed for a given restriction? 1/2p,1p,2p,3p,4p

# Section 2 : What are the time frames where parking lots are the most vacant/occupied?

# Section 3 : Parking availability: On a workday/non-workday, what are the time frames where parking lots are the most vacant/occupied? 

```{r} 

hols_2019 <- tsibble::holiday_aus(year = 2019, state = "VIC")

#create dataset for holidays related to arr_date
park_2019_hols <- park19 %>% 
  mutate(weekday = wday(arr_date, label = TRUE, week_start = 1),
         workday = if_else(
           condition = arr_date %in% hols_2019$date | weekday %in% c("Sat", "Sun"),
           true = "holidays",
           false = "workday"))

```

```{r workdays-vs-non-work}
ggplot(park_2019_hols,
       aes(x = as.factor(arr_hour),
           y = DurationMinutes,
            group = arr_date, # Because there are duplicate date in different months, so we use this
           # colour = SignPlateID) 
       ))+
  geom_line(size = 0.3,
            alpha = 0.3) +
  facet_grid(SignPlateID~workday,
             labeller = labeller(StreetName = label_wrap_gen(20))) +
  scale_colour_brewer(palette = "Set2", name = "SignPlateID") +
  theme(legend.position = "none")
```

SignPlateID 3 only Sunday
SignPlateID 583 is for disability (never occupied)
SignPlateID 508 is Mon-Sat 6.30 to 20.30 (small window)

```{r}
plat_508 <- park_2019_hols %>%
  select(arr_date, arr_hour, workday, SignPlateID, Sign, DurationMinutes) %>% 
  filter(SignPlateID == 508) %>%
  group_by(arr_date, workday, arr_hour)

plat_508
ggplot(plat_508,
       aes(x = as.factor(arr_hour),
           y = DurationMinutes,
            group = arr_date, # Because there are duplicate date in different months, so we use this
                  ))+
  geom_line(size = 0.3,
            alpha = 0.3) +
  facet_grid(~workday,
             labeller = labeller(StreetName = label_wrap_gen(20))) +
  scale_colour_brewer(palette = "Set2", name = "StreetName") +
  theme(legend.position = "none")
```


```{r calendar-plot}

russel_cal <- park_2019_hols %>% 
  frame_calendar(x = arr_hour,
                 y = DurationMinutes,
                 date = arr_date)

gg_cal <- russel_cal %>% 
  ggplot(aes(x = .arr_hour,
             y = .DurationMinutes,
             colour = workday,
             group = arr_date)) +
  geom_line()

prettify(gg_cal) +
  theme(legend.position = "bottom")
```

# Section 4 : There any prominent characteristics for the top 10 hardest parking street to get in Melbourne CBD?  **we need a new dataset here**
```{r}
#top10 <- read_csv("On-street_Car_Parking_Sensor_Data_-_2019.csv") 

#print_table <- function(table, head){
#  table %>%
#  group_by(StreetName, BetweenStreet1, BetweenStreet2) %>%
#  summarise(CountperDay= n()/365) %>%
#   arrange(desc(CountperDay)) %>%
#  head(head)
#}

#save_table <- print_table(top10, 10)
#write_csv(save_table, "Top10_Melb_Count.csv")

top10_table <- read_csv("Top10_Melb_Count.csv")
knitr::kable(top10_table, caption = "Top 10 busiest parking street in Melbourne") %>%
kableExtra::kable_styling(bootstrap_options = "basic")

```

```{r bincol}
coord <- data_frame("lat" = c(-37.8147255,
                              -37.8192437,
                              -37.8101661,
                              -37.8183015,
                              -37.8156404,
                              -37.809040,
                              -37.8140175,
                              -37.8153781,
                              -37.8075632,
                              -37.816335),
                    "lon"=c(144.952553,
                            144.9553465,
                            144.9687394,
                            144.9811929,
                            144.976875,
                            144.969121,
                            144.9692056,
                            144.9531639,
                            144.9532773,
                            144.978169))


top10cor <- bind_cols(top10_table,coord)
```

```{r leaflet_map}
# Map for locations
cb_bbox <- make_bbox(lon = top10cor$lon,
                     lat = top10cor$lat,
                     f = 0.9)  

best_locations = leaflet() %>%
  # Base group
  addProviderTiles(providers$Esri.WorldImagery, group="Satellite") %>%
  # Add reciever location data
  addCircles(
    lng = top10cor$lon,
    lat = top10cor$lat, 
    fill=TRUE, color="red",
    weight= 5,
    radius = 2,
    stroke = FALSE, fillOpacity = 1)
```

```{r leaflet_markers}
leaflet(data = top10cor[1:10,]) %>%
  addTiles() %>%
  addMarkers(~lon, ~lat, popup = ~as.character(StreetName), label = ~as.character(StreetName))
```

```{r leaflet_markersSatllite}
leaflet(data = top10cor[1:10,]) %>%
  addProviderTiles(providers$Esri.WorldImagery, group="Satellite") %>%
  #addTiles() %>%
  addMarkers(~lon, ~lat, popup = ~as.character(StreetName), label = ~as.character(StreetName))
```
-**LONSDALE STREET**	: Lonsdale Street is one of the main streets in Melbourne's CBD. It offers high rise apartment style living, in amongst the areas businesses, shopping centres and hotels. China Town extends through a number of smaller alleys between Lonsdale and Bourke.
-**KING STREET**	 : A key hub of Melbourne's nightlife and is home to many pubs, nightclubs, restaurants, and adult entertainment venues.
-**JOLIMONT STREET**	: Features parks, business precincts and a limited amount of residential accommodation. It's close to Fitzroy Garden and Melbourne Cricket Ground.
-**EXHIBITION STREET**	: There a lot of luxurious hotels eg Marriott Hotel & Rydges Hotel. I also the heart of working district
-**WILLIAM STREET**	: A major street in the city, there are notable landmarks on William Street include the Queen Victoria Market, the Flagstaff Gardens, Immigration Museum, Supreme Court of Victoria, AMP Square,
-**WELLINGTON PARADE SOUTH** : It's located between parks and residential building.

# DEADLINE : TOMORROW